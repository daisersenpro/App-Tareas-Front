<div class="container mt-4">
  <div class="bg-white p-4 shadow rounded">
    <h2 class="mb-4 text-center">Lista de Tareas</h2>

    <!-- 
      Formulario para agregar una nueva tarea con más campos.
      (ngSubmit)="agregarTarea()" indica que al enviar el formulario se ejecuta la función agregarTarea() del componente TypeScript.
      #formTarea="ngForm" crea una referencia local al formulario para poder validar si es válido o no.
    -->
    <form class="row g-3 mb-3" (ngSubmit)="agregarTarea()" #formTarea="ngForm">
      <div class="col-12 col-md-3">
        <!-- 
          Input de texto para el título de la tarea.
          [(ngModel)]="nuevoTitulo" es un ENLACE BIDIRECCIONAL.
        -->
        <input
          type="text"
          name="titulo"
          [(ngModel)]="nuevoTitulo"
          placeholder="Título de la tarea"
          required
          class="form-control"
        />
      </div>
      <div class="col-12 col-md-3">
        <!-- 
          Input de texto para la descripción de la tarea.
          [(ngModel)]="nuevaDescripcion" es un ENLACE BIDIRECCIONAL.
        -->
        <input
          type="text"
          name="descripcion"
          [(ngModel)]="nuevaDescripcion"
          placeholder="Descripción"
          required
          class="form-control"
        />
      </div>
      <div class="col-6 col-md-2">
        <!-- 
          Selector para la prioridad de la tarea.
          1 = Alta, 2 = Media, 3 = Baja
        -->
        <select
          name="prioridad"
          [(ngModel)]="nuevaPrioridad"
          required
          class="form-select"
        >
          <option [ngValue]="1">Alta</option>
          <option [ngValue]="2">Media</option>
          <option [ngValue]="3">Baja</option>
        </select>
      </div>
      <div class="col-6 col-md-2">
        <!-- 
          Input para la fecha de vencimiento de la tarea.
        -->
        <input
          type="date"
          name="fechaVencimiento"
          [(ngModel)]="nuevaFechaVencimiento"
          class="form-control"
        />
      </div>
      <div class="col-12 col-md-2">
        <!-- 
          Botón para agregar la tarea.
          [disabled]="formTarea.invalid" desactiva el botón si el formulario no es válido.
        -->
        <button type="submit" [disabled]="formTarea.invalid" class="btn btn-primary w-100">
          <i class="bi bi-plus-circle"></i> Agregar
        </button>
      </div>
    </form>

    <!-- 
      Mensaje que se muestra solo mientras se están cargando las tareas desde el backend.
      *ngIf="cargando" significa que este div solo aparece si la variable cargando es true.
    -->
    <div *ngIf="cargando" class="alert alert-info">Cargando tareas...</div>

    <!-- 
      Lista de tareas.
      *ngIf="!cargando" significa que la lista solo se muestra cuando ya terminaron de cargarse las tareas.
    -->
    <ul class="list-group" *ngIf="!cargando">
      <!-- 
        *ngFor="let tarea of tareas" recorre el array tareas y crea un <li> por cada tarea.
        Así se muestra cada tarea que existe en la base de datos.
      -->
      <li *ngFor="let tarea of tareas" class="list-group-item d-flex justify-content-between align-items-center">
        <span>
          <!-- 
            Muestra el título de la tarea.
          -->
          <strong>{{ tarea.titulo }}</strong>
          <!-- 
            Muestra la descripción de la tarea.
          -->
          <div class="text-muted small">{{ tarea.descripcion }}</div>
          <!-- 
            Muestra la prioridad de la tarea.
          -->
          <span class="badge bg-secondary me-1">
            Prioridad: 
            <span *ngIf="tarea.prioridad === 1">Alta</span>
            <span *ngIf="tarea.prioridad === 2">Media</span>
            <span *ngIf="tarea.prioridad === 3">Baja</span>
          </span>
          <!-- 
            Muestra la fecha de vencimiento si existe.
          -->
          <span *ngIf="tarea.fechaVencimiento" class="badge bg-info text-dark me-1">
            Vence: {{ tarea.fechaVencimiento | date:'shortDate' }}
          </span>
          <!-- 
            Si la tarea está completada, muestra una insignia verde con el texto "Completada" y un icono.
          -->
          <span *ngIf="tarea.completada" class="badge bg-success ms-2">
            <i class="bi bi-check-circle"></i> Completada
          </span>
        </span>
        <span>
          <!-- 
            Botón para marcar la tarea como completada.
            Solo aparece si la tarea NO está completada.
          -->
          <button
            *ngIf="!tarea.completada"
            (click)="marcarComoCompletada(tarea)"
            type="button"
            class="btn btn-success btn-sm me-2"
          >
            <i class="bi bi-check-circle"></i> Completar
          </button>
          <!-- 
            Botón para eliminar la tarea.
          -->
          <button
            (click)="eliminarTarea(tarea)"
            type="button"
            class="btn btn-danger btn-sm"
          >
            <i class="bi bi-trash"></i> Eliminar
          </button>
        </span>
      </li>
    </ul>
  </div>
</div>